---
- hosts: all
  remote_user: vagrant
  become: true
  vars:
    gearman:
      proxy: "172.16.1.10"
      servers:
        - "172.16.1.15"
        - "172.16.1.16"
  tasks:

    - debug:
        msg: "{{ ansible_distribution }}/{{ ansible_distribution_major_version }}"

    - include_role:
        name: "{{ item }}"
      with_items: "{{ ansible_local['roles'] | default('gearman-common') }}"

    - ansible.builtin.file:
        path: "/etc/ansible/facts.d/"
        state: "directory"

    - ansible.builtin.copy:
        content: "{{ ansible_local['roles'] | default(['gearman-common']) | to_nice_json }}"
        dest: "/etc/ansible/facts.d/roles.fact"
