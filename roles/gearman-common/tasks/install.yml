---

- name: "Debian package update"
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_distribution == "Debian"

- name: "Debian python3 installer"
  ansible.builtin.apt:
    name: "python3"
  when: ansible_distribution == "Debian"

- name: "Debian python3-pip installer"
  ansible.builtin.apt:
    name: "python3-pip"
  when: ansible_distribution == "Debian"

- name: "Debian prometheus-node-exporter installer"
  ansible.builtin.apt:
    name: "prometheus-node-exporter"
  when: ansible_distribution == "Debian"

- name: "Ubuntu package update"
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_distribution == "Ubuntu"

- name: "Ubuntu python3 installer"
  ansible.builtin.apt:
    name: "python3"
  when: ansible_distribution == "Ubuntu"

- name: "Ubuntu python3-pip installer"
  ansible.builtin.apt:
    name: "python3-pip"
  when: ansible_distribution == "Ubuntu"

- name: "Ubuntu prometheus-node-exporter installer"
  ansible.builtin.apt:
    name: "prometheus-node-exporter"
  when: ansible_distribution == "Ubuntu"

- name: "AlmaLinux python package installer"
  ansible.builtin.dnf:
    name: "python3-pip"
  when: ansible_distribution == "AlmaLinux"

- name: "Rocky epel package"
  ansible.builtin.dnf:
    name: "epel-release"
  when: ansible_distribution == "Rocky"

- name: "Rocky gearmand package"
  ansible.builtin.dnf:
    name: "gearmand"
  when: ansible_distribution == "Rocky"

- name: "CentOS7 python package installer"
  ansible.builtin.yum:
    name: "python3-pip"
  when:
    - ansible_distribution == "CentOS"
    - ansible_distribution_major_version == "7"

- name: "Asynchronous Event-Driven Gearman Interface"
  ansible.builtin.pip:
    name: "gear"

- ansible.builtin.template:
    src: "inventory-register.py.j2"
    dest: "/usr/local/sbin/inventory-register.py"
    mode: "0755"

- ansible.builtin.find:
    paths: "/etc/ansible/roles"
    file_type: "directory"
  delegate_to: localhost
  register: search

- ansible.builtin.template:
    src: "management.py.j2"
    dest: "/usr/local/sbin/management.py"
    mode: "0755"
  vars:
    roles: "{{ search.files | map(attribute='path') | map('regex_replace', '/etc/ansible/roles/') }}"
